<div class="max-w-4xl mx-auto px-4 py-6" *ngIf="book">
  <div class="flex justify-between items-center mb-4">
    <a
      routerLink="/books/get"
      class="text-sm text-gray-500 hover:text-gray-700 transition inline-flex items-center"
    >
      Вернуться ко всем книгам
    </a>
    <a
      [routerLink]="['/books', bookId, 'edit']"
      class="text-sm text-gray-500 hover:text-gray-700 transition inline-flex items-center"
    >
      Редактировать
    </a>
  </div>

  <h1 class="text-2xl font-bold mb-4">{{ book.title }}</h1>

  <div *ngIf="book.cover" class="mb-4">
    <img
      [src]="book.cover.startsWith('http') ? book.cover : BaseUrl + book.cover"
      alt="Обложка"
      class="w-full max-h-64 object-cover rounded"
    />
  </div>

  <p class="text-gray-700 mb-4">{{ book.description }}</p>

  <p class="text-sm text-gray-600 mb-2">Автор: {{ book.author }}</p>

  <div class="flex flex-wrap gap-2 mb-4">
    <span
      *ngFor="let genre of book.genres"
      class="bg-orange-100 text-orange-800 text-xs font-medium px-2 py-1 rounded"
    >
      {{ genre.name }}
    </span>
  </div>

  <div *ngIf="book.chapters?.length > 0">
    <h2 class="text-lg font-semibold mb-2">Главы:</h2>
    <ol class="list-decimal pl-6">
      <li *ngFor="let chapter of book.chapters">
        <a
          class="text-sm text-gray-500 hover:text-gray-700 transition inline-flex items-center"
          [routerLink]="['/books', book.id, 'chapters', chapter.id]"
        >
          {{ chapter.title }}
        </a>
      </li>
    </ol>
  </div>

  <p *ngIf="book.chapters?.length === 0" class="text-gray-500 italic">
    Главы пока не добавлены.
  </p>

  <div class="mt-6 text-center" *ngIf="bookId">
    <a
      [routerLink]="['/books', bookId, 'chapters', 'add']"
      class="inline-block font-semibold py-2 px-4 rounded transition"
    >
      ➕ Добавить главу
    </a>
  </div>
</div>

<p *ngIf="errorMessage" class="text-red-600 text-center mt-4">
  {{ errorMessage }}
</p>

<!-- Форма комментария — только если пользователь ещё не оставил комментарий -->
<div class="mt-1 form-container" *ngIf="!userComment">
  <app-add-comment
    [bookId]="bookId"
    (commentAdded)="onCommentAdded()"
  ></app-add-comment>

  <!-- Комментарии -->
  <div class="w-[80%] mx-auto">
    <h2
      class="text-xl font-semibold mb-6 border-b pb-2 border-gray-300 text-gray-800"
    >
      Комментарии
    </h2>

    <p
      *ngIf="!userComment && otherComments.length === 0"
      class="text-gray-500 italic text-sm"
    >
      Комментариев пока нет.
    </p>

    <div
      *ngIf="userComment"
      class="mb-6 border border-gray-300 rounded bg-white shadow-md p-4 relative"
    >
      <div class="text-base font-semibold text-gray-900 mb-1 pl-2">
        {{ userComment.user }}
      </div>

      <a
        [routerLink]="['/books', bookId, 'edit-comment']"
        class="absolute top-2 right-3 text-sm text-gray-500 hover:text-gray-700 transition"
      >
        Редактировать
      </a>

      <p class="text-gray-800 mb-2 whitespace-pre-line text-sm leading-relaxed">
        {{ userComment.content }}
      </p>

      <div class="flex justify-between items-center text-xs text-gray-600 mt-2">
        <span>Оценка: {{ userComment.rating }} / 5</span>
        <span>{{ userComment.created_at | date : "dd.MM.yyyy HH:mm" }}</span>
      </div>
    </div>

    <!-- Остальные комментарии -->
    <div
      *ngFor="let comment of otherComments"
      class="mb-6 border border-gray-300 rounded bg-gray-50 p-4 shadow-sm"
    >
      <div class="text-base font-semibold text-gray-900 mb-1">
        {{ comment.user }}
      </div>
      <p class="text-gray-800 mb-2 whitespace-pre-line text-sm leading-relaxed">
        {{ comment.content }}
      </p>
      <div class="flex justify-between items-center text-xs text-gray-600 mt-2">
        <span>Оценка: {{ comment.rating }} / 5</span>
        <span>{{ comment.created_at | date : "dd.MM.yyyy HH:mm" }}</span>
      </div>
    </div>
  </div>
</div>
